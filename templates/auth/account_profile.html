<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Account Profile</title>
  </head>
  <body>
    <h1>Profil</h1>
    <div id="profile">
      <div>Username: <span id="username"></span></div>
      <div>Email: <input id="email" /></div>
      <div>Display name: <input id="display_name" /></div>
      <button id="save">Save</button>
    </div>
    <div id="status"></div>

    <script>
      async function loadProfile(){
        const r = await fetch('/auth/account/profile');
        if(r.ok){
          const j = await r.json();
          document.getElementById('username').textContent = j.username;
          document.getElementById('email').value = j.email || '';
          document.getElementById('display_name').value = j.display_name || '';
        } else {
          document.getElementById('status').textContent = 'Bitte einloggen.';
        }
      }
      document.getElementById('save').addEventListener('click', async () => {
        const body = {display_name: document.getElementById('display_name').value, email: document.getElementById('email').value};
        const r = await fetch('/auth/account/profile', {method: 'PATCH', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body)});
        const j = await r.json();
        document.getElementById('status').textContent = j.ok ? 'Gespeichert' : 'Fehler';
      });
      loadProfile();
    </script>
  </body>
</html>
