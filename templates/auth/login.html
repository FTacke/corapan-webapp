{% extends "base.html" %}

{% block title %}Anmelden - CO.RA.PAN{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/md3/components/login.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/md3/components/auth.css') }}">
{% endblock %}

{% block content %}
<div class="md3-page">
  <header class="md3-page__header md3-stack--section">
    <!-- Page header kept intentionally minimal for login pages; visually hidden H1 for accessibility -->
    <!-- Keep H1 empty so page-title logic (pickTitle) prefers site title / suffix instead -->
    <h1 class="sr-only"></h1>
  </header>

  <main class="page-inner">
    <section class="page-section">
      <!-- Login Card -->
      <article class="md3-card md3-card--outlined md3-auth-card login-card">
        <!-- Header -->
        <header class="md3-card__header">
          <h2 class="md3-title-large md3-card__title">Anmelden</h2>
        </header>

        <div class="md3-card__content">
          <p class="body-large">Melde dich mit deinem Benutzernamen oder deiner E‑Mail an.</p>

          <!-- Error Messages (if any) -->
          {# Global form error banner (MD3, compact) #}
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              <div class="md3-alert md3-alert--error" role="alert" aria-live="assertive">
                <span class="md3-alert__icon material-symbols-rounded">error</span>
                <div class="md3-alert__text">
                  {% for category, message in messages %}
                    <div>{{ message }}</div>
                  {% endfor %}
                </div>
              </div>
            {% endif %}
          {% endwith %}

          <!-- Login Form - Standard HTML POST (no HTMX) -->
          <form id="login-form" 
              class="md3-auth-form" 
              method="post" 
              action="{{ url_for('auth.login_post') }}"
              novalidate>
            
            <!-- Username Field -->
            <div class="md3-outlined-textfield md3-outlined-textfield--block">
              <input 
                type="text" 
                class="md3-outlined-textfield__input" 
                name="username" 
                id="login-username"
                autocomplete="username" 
                required
                aria-label="Benutzername"
                minlength="1"
                maxlength="50">
              <label class="md3-outlined-textfield__label" for="login-username">Benutzername oder E‑Mail</label>
              <span class="md3-outlined-textfield__outline">
                <span class="md3-outlined-textfield__outline-start"></span>
                <span class="md3-outlined-textfield__outline-notch"></span>
                <span class="md3-outlined-textfield__outline-end"></span>
              </span>
            </div>

            <!-- Password Field -->
            <div class="md3-outlined-textfield md3-outlined-textfield--block">
              <input 
                type="password" 
                class="md3-outlined-textfield__input" 
                name="password" 
                id="login-password"
                autocomplete="current-password" 
                required
                aria-label="Passwort"
                minlength="1">
              <label class="md3-outlined-textfield__label" for="login-password">Passwort</label>
              <span class="md3-outlined-textfield__outline">
                <span class="md3-outlined-textfield__outline-start"></span>
                <span class="md3-outlined-textfield__outline-notch"></span>
                <span class="md3-outlined-textfield__outline-end"></span>
              </span>
            </div>

            <div class="md3-row--between md3-actions">
               <a class="md3-button md3-button--text" href="{{ url_for('auth.password_forgot_page') }}">Passwort vergessen?</a>
               <button type="submit" class="md3-button md3-button--filled">
                Anmelden
              </button>
            </div>

            <!-- Hidden next URL (for redirect after login) -->
            {% if next %}
              <input type="hidden" name="next" value="{{ next }}">
            {% endif %}
          </form>
        </div>
      </article>
      
      <!-- Footer -->
      <div class="md3-card__footer md3-login-card__footer">
        <p class="md3-body-small">
          Probleme beim Anmelden? Kontaktiere uns unter
          <a href="mailto:support@corapan.de" class="md3-link">support@corapan.de</a>
        </p>
      </div>
    </section>
  </main>
</div>
{% endblock %}
