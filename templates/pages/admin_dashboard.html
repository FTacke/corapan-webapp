{% extends 'base.html' %}
{% block page_title %}Admin-Dashboard &middot; CO.RA.PAN{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/md3/tokens.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/md3/typography.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/md3/components/hero.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/md3/components/progress.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/md3/components/admin-dashboard.css') }}">
{% endblock %}

{% block content %}
<!-- MD3 Admin Dashboard - Analytics (Variante 3a: nur Zähler, keine Suchinhalte) -->
<div class="md3-page">
  <header class="md3-page__header">
    <div class="md3-hero md3-hero--card md3-hero__container">
      <div class="md3-hero__icon" aria-hidden="true"><span class="material-symbols-rounded">dashboard</span></div>
      <div class="md3-hero__content">
        <p class="md3-body-small md3-hero__eyebrow">Admin</p>
        <h1 class="md3-headline-medium md3-hero__title">Analytics Dashboard</h1>
        <p class="md3-body-medium md3-hero__intro">
          Anonyme Nutzungsstatistiken
        </p>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="md3-page__main md3-stack--page">
    
    <!-- Section: 30-Tage Metriken -->
    <section class="md3-page__section">
      <h2 class="md3-title-large md3-section-title">Letzte 30 Tage</h2>
      
      <!-- KPI Cards Grid (30 Tage) -->
      <div class="md3-admin-metrics" data-element="metrics-grid">
        
        <!-- Visitors Card -->
        <article class="md3-card md3-card--outlined md3-metric-card" data-metric="visitors">
          <div class="md3-metric-card__header">
            <div class="md3-metric-card__icon-wrapper">
              <span class="material-symbols-rounded" aria-hidden="true">people</span>
            </div>
            <h3 class="md3-title-medium">Besuche</h3>
          </div>
          <div class="md3-metric-card__content">
            <!-- Skeleton State -->
            <div class="md3-metric-card__skeleton" aria-hidden="true">
              <div class="md3-skeleton md3-skeleton--metric-value"></div>
              <div class="md3-skeleton md3-skeleton--metric-sub"></div>
            </div>
            <!-- Data State (hidden initially) -->
            <div class="md3-metric-card__data" hidden>
              <span class="md3-display-small" id="visitors-total">–</span>
              <span class="md3-label-medium md3-metric-card__sub" id="device-breakdown">Mobile –% · Desktop –%</span>
            </div>
          </div>
        </article>

        <!-- Searches Card -->
        <article class="md3-card md3-card--outlined md3-metric-card" data-metric="searches">
          <div class="md3-metric-card__header">
            <div class="md3-metric-card__icon-wrapper">
              <span class="material-symbols-rounded" aria-hidden="true">search</span>
            </div>
            <h3 class="md3-title-medium">Suchanfragen</h3>
          </div>
          <div class="md3-metric-card__content">
            <div class="md3-metric-card__skeleton" aria-hidden="true">
              <div class="md3-skeleton md3-skeleton--metric-value"></div>
            </div>
            <div class="md3-metric-card__data" hidden>
              <span class="md3-display-small" id="searches-total">–</span>
            </div>
          </div>
        </article>

        <!-- Audio Card -->
        <article class="md3-card md3-card--outlined md3-metric-card" data-metric="audio">
          <div class="md3-metric-card__header">
            <div class="md3-metric-card__icon-wrapper">
              <span class="material-symbols-rounded" aria-hidden="true">play_circle</span>
            </div>
            <h3 class="md3-title-medium">Audio-Plays</h3>
          </div>
          <div class="md3-metric-card__content">
            <div class="md3-metric-card__skeleton" aria-hidden="true">
              <div class="md3-skeleton md3-skeleton--metric-value"></div>
            </div>
            <div class="md3-metric-card__data" hidden>
              <span class="md3-display-small" id="audio-total">–</span>
            </div>
          </div>
        </article>

        <!-- Errors Card -->
        <article class="md3-card md3-card--outlined md3-metric-card" data-metric="errors">
          <div class="md3-metric-card__header">
            <div class="md3-metric-card__icon-wrapper md3-metric-card__icon-wrapper--error">
              <span class="material-symbols-rounded" aria-hidden="true">error</span>
            </div>
            <h3 class="md3-title-medium">Fehler</h3>
          </div>
          <div class="md3-metric-card__content">
            <div class="md3-metric-card__skeleton" aria-hidden="true">
              <div class="md3-skeleton md3-skeleton--metric-value"></div>
            </div>
            <div class="md3-metric-card__data" hidden>
              <span class="md3-display-small" id="errors-total">–</span>
            </div>
          </div>
        </article>
        
      </div>
    </section>

    <!-- Section: Gesamt seit Projektstart -->
    <section class="md3-page__section">
      <h2 class="md3-title-large md3-section-title">Gesamt seit Projektstart</h2>
      
      <!-- Overall Totals Cards Grid -->
      <div class="md3-admin-metrics md3-admin-metrics--compact" data-element="totals-overall-grid">
        
        <!-- Visitors Overall -->
        <article class="md3-card md3-card--outlined md3-metric-card md3-metric-card--compact" data-metric="visitors-overall">
          <div class="md3-metric-card__header">
            <span class="material-symbols-rounded md3-metric-card__icon" aria-hidden="true">people</span>
            <h3 class="md3-title-medium">Besuche gesamt</h3>
          </div>
          <div class="md3-metric-card__content">
            <div class="md3-metric-card__skeleton" aria-hidden="true">
              <div class="md3-skeleton md3-skeleton--metric-value"></div>
            </div>
            <div class="md3-metric-card__data" hidden>
              <span class="md3-headline-medium" id="visitors-overall">–</span>
            </div>
          </div>
        </article>

        <!-- Searches Overall -->
        <article class="md3-card md3-card--outlined md3-metric-card md3-metric-card--compact" data-metric="searches-overall">
          <div class="md3-metric-card__header">
            <span class="material-symbols-rounded md3-metric-card__icon" aria-hidden="true">search</span>
            <h3 class="md3-title-medium">Suchanfragen gesamt</h3>
          </div>
          <div class="md3-metric-card__content">
            <div class="md3-metric-card__skeleton" aria-hidden="true">
              <div class="md3-skeleton md3-skeleton--metric-value"></div>
            </div>
            <div class="md3-metric-card__data" hidden>
              <span class="md3-headline-medium" id="searches-overall">–</span>
            </div>
          </div>
        </article>

        <!-- Audio Overall -->
        <article class="md3-card md3-card--outlined md3-metric-card md3-metric-card--compact" data-metric="audio-overall">
          <div class="md3-metric-card__header">
            <span class="material-symbols-rounded md3-metric-card__icon" aria-hidden="true">play_circle</span>
            <h3 class="md3-title-medium">Audio-Plays gesamt</h3>
          </div>
          <div class="md3-metric-card__content">
            <div class="md3-metric-card__skeleton" aria-hidden="true">
              <div class="md3-skeleton md3-skeleton--metric-value"></div>
            </div>
            <div class="md3-metric-card__data" hidden>
              <span class="md3-headline-medium" id="audio-overall">–</span>
            </div>
          </div>
        </article>
        
      </div>
    </section>

    <!-- Section: Letzte 7 Tage Tabelle -->
    <section class="md3-page__section">
      <article class="md3-card md3-card--outlined">
        <header class="md3-card__header">
          <h2 class="md3-title-large">Letzte 7 Tage</h2>
        </header>
        <div class="md3-card__content">
          <!-- Skeleton State für Tabelle -->
          <div class="md3-table-skeleton" id="table-skeleton" aria-hidden="true">
            <div class="md3-skeleton md3-skeleton--table-row"></div>
            <div class="md3-skeleton md3-skeleton--table-row"></div>
            <div class="md3-skeleton md3-skeleton--table-row"></div>
            <div class="md3-skeleton md3-skeleton--table-row"></div>
            <div class="md3-skeleton md3-skeleton--table-row"></div>
            <div class="md3-skeleton md3-skeleton--table-row"></div>
            <div class="md3-skeleton md3-skeleton--table-row"></div>
          </div>
          <!-- Data Table (hidden initially) -->
          <div class="md3-table-container" id="table-container" hidden>
            <table class="md3-table md3-admin-table">
              <thead>
                <tr>
                  <th scope="col">Datum</th>
                  <th scope="col">Besuche</th>
                  <th scope="col">Suchanfragen</th>
                </tr>
              </thead>
              <tbody id="analytics-last-7-days">
                <!-- JS füllt Zeilen -->
              </tbody>
            </table>
          </div>
        </div>
      </article>
    </section>

    <!-- VARIANTE 3a: Keine Top-Queries Sektion! Keine Suchinhalte gespeichert. -->

    <!-- Section: Datenschutz-Hinweis -->
    <section class="md3-page__section">
      <article class="md3-card md3-card--filled md3-info-card">
        <header class="md3-card__header">
          <span class="material-symbols-rounded md3-info-card__icon" aria-hidden="true">info</span>
          <h2 class="md3-title-medium">Datenschutz-Hinweis</h2>
        </header>
        <div class="md3-card__content">
          <ul class="md3-info-list md3-body-medium">
            <li>Es werden ausschließlich <strong>anonyme, aggregierte Zähler</strong> gespeichert</li>
            <li>Keine IP-Adressen, User-IDs, Cookies oder Fingerprints</li>
            <li>Keine Suchinhalte oder Query-Texte (Variante 3a)</li>
            <li>DSGVO-konform – kein Einwilligungsbanner erforderlich</li>
          </ul>
        </div>
      </article>
    </section>

    <!-- Error State (hidden initially) -->
    <div class="md3-error-banner" id="error-banner" hidden aria-live="polite">
      <article class="md3-card md3-card--outlined md3-error-card md3-alert" role="alert">
        <span class="material-symbols-rounded md3-error-card__icon" aria-hidden="true">error</span>
        <div class="md3-error-card__content">
          <p class="md3-body-large">Analytics konnten nicht geladen werden.</p>
          <p class="md3-body-medium">Bitte versuchen Sie es später erneut.</p>
        </div>
        <button type="button" class="md3-button md3-button--tonal" id="retry-button">
          <span class="material-symbols-rounded md3-button__icon" aria-hidden="true">refresh</span>
          <span class="md3-button__label">Erneut versuchen</span>
        </button>
      </article>
    </div>

  </main>
</div>
{% endblock %}

{% block extra_scripts %}
  <script type="module" src="{{ url_for('static', filename='js/modules/admin/dashboard.js') }}" defer></script>
{% endblock %}
